ARG VLLM_VERSION
FROM runpod/pytorch:2.4.0-py3.11-cuda12.4.1-devel-ubuntu22.04

ARG VLLM_VERSION

# Install the target vllm version on top of pre-installed pytorch.
# pip will reuse the existing torch/cuda packages when compatible.
RUN pip install --no-cache-dir "vllm==${VLLM_VERSION}"

WORKDIR /app
COPY pyproject.toml README.md ./
COPY vllm_bootstrap ./vllm_bootstrap

# Install project + dev deps (pytest). vllm is already satisfied above
# so pip will skip it even if [vllm] extra is not requested.
RUN pip install --no-cache-dir ".[dev]"

ENV PYTHONPATH=/app
CMD ["python3", "-m", "pytest", "-q", "vllm_bootstrap/__tests__/test_vllm_compat.py"]
